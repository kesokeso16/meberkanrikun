<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>名簿管理アプリ</title>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js"></script>
  <link rel="manifest" href="/manifest.json">
<link rel="icon" href="/icon-192.png">
<meta name="theme-color" content="#ffffff">

</head>
<body>
  <h2>名簿追加フォーム</h2>

  <input type="text" id="name" placeholder="名前"><br>
  <input type="text" id="name2" placeholder="よみ"><br>
  <input type="text" id="club" placeholder="クラブ名"><br>
  <input type="text" id="role" placeholder="役職"><br>

  所属:<br>
  <label><input type="checkbox" value="RC">RC</label>
  <label><input type="checkbox" value="RAC">RAC</label>
  <label><input type="checkbox" value="地区RAC">地区RAC</label>
  <label><input type="checkbox" value="OBOG">OBOG</label>
  <label><input type="checkbox" value="ゲスト">ゲスト</label>
  <br>

  <input type="number" id="cluborder" placeholder="クラブ発会順"><br>
  <input type="number" id="roleorder" placeholder="役職順"><br>

  <button onclick="addMember()">追加</button>

  <h2>名簿一覧</h2>
  <div id="memberList"></div>

  <script>
 if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
    .then(reg => console.log("Service Worker Registered", reg))
    .catch(err => console.log("SW registration failed", err));
  }


    // Firebase初期化
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // メンバー追加関数
    async function addMember() {
      const name = document.getElementById("name").value;
      const name2 = document.getElementById("name2").value;
      const club = document.getElementById("club").value;
      const role = document.getElementById("role").value;
      const cluborder = parseInt(document.getElementById("cluborder").value);
      const roleorder = parseInt(document.getElementById("roleorder").value);

      const affiliations = [];
      document.querySelectorAll('input[type=checkbox]:checked').forEach(cb => {
        affiliations.push(cb.value);
      });

      // 重複チェック: 名前が同じドキュメントがあるか
      const snapshot = await db.collection("member").where("name", "==", name).get();

      if (!snapshot.empty) {
        alert("同じ名前のデータが存在します。更新します。");

        // 既存データを更新
        snapshot.forEach(doc => {
          db.collection("member").doc(doc.id).update({
            name2: name2,
            club: club,
            role: role,
            affiliations: affiliations,
            cluborder: cluborder,
            roleorder: roleorder
          });
        });

      } else {
        // 新規追加
        db.collection("member").add({
          name: name,
          name2: name2,
          club: club,
          role: role,
          affiliations: affiliations,
          cluborder: cluborder,
          roleorder: roleorder
        });
        alert("追加完了！");
      }

      loadMembers(); // 更新後に再読み込み
    }

    // メンバー一覧取得関数
    async function loadMembers() {
      const memberList = document.getElementById("memberList");
      memberList.innerHTML = "";

      const snapshot = await db.collection("member").orderBy("cluborder").get();

      snapshot.forEach(doc => {
        const data = doc.data();
        memberList.innerHTML += `${data.name} (${data.role}) - ${data.club}<br>`;
      });
    }

    // 初期表示
    loadMembers();
  </script>
</body>
</html>
